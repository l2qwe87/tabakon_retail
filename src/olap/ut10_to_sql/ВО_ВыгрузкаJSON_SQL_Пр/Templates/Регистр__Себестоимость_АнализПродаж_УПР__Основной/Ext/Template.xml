<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>Запрос</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номенклатура</dataPath>
			<field>Номенклатура</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Подразделение</dataPath>
			<field>Подразделение</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ХарактеристикаНоменклатуры</dataPath>
			<field>ХарактеристикаНоменклатуры</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПродажиБезНДС</dataPath>
			<field>ПродажиБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Продажи без НДС</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДокументПродажи</dataPath>
			<field>ДокументПродажи</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказПокупателя</dataPath>
			<field>ЗаказПокупателя</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоговорКонтрагента</dataPath>
			<field>ДоговорКонтрагента</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Проект</dataPath>
			<field>Проект</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Организация</dataPath>
			<field>Организация</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Контрагент</dataPath>
			<field>Контрагент</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДокументОприходования</dataPath>
			<field>ДокументОприходования</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Регистратор</dataPath>
			<field>Регистратор</field>
			<role>
				<dcscom:periodNumber>1</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СебестоимостьУПР</dataPath>
			<field>СебестоимостьУПР</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Себестоимость УПР</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СебестоимостьБезНДС_УПР</dataPath>
			<field>СебестоимостьБезНДС_УПР</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Себестоимость без НДС УПР</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Магазин</dataPath>
			<field>Магазин</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Магазин</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПрибыльУПР</dataPath>
			<field>ПрибыльУПР</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Прибыль УПР</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СебестоимостьИтого</dataPath>
			<field>СебестоимостьИтого</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Себестоимость итого</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Продажии</dataPath>
			<field>Продажии</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Продажии</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Дата</dataPath>
			<field>Дата</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Дата</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	МинимальныйОстаток.Склад,
	МинимальныйОстаток.Номенклатура,
	МАКСИМУМ(МинимальныйОстаток.МинОстаток) КАК МинОстаток
ПОМЕСТИТЬ МО
ИЗ
	РегистрСведений.МинимальныйОстаток КАК МинимальныйОстаток

СГРУППИРОВАТЬ ПО
	МинимальныйОстаток.Склад,
	МинимальныйОстаток.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КатегорииОбъектов.Объект,
	КатегорииОбъектов.Категория
ПОМЕСТИТЬ Кат
ИЗ
	РегистрСведений.КатегорииОбъектов КАК КатегорииОбъектов
ГДЕ
	КатегорииОбъектов.Объект ССЫЛКА Справочник.Склады
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	ПродажиОбороты.Номенклатура,
	ПродажиОбороты.Организация,
	ПродажиОбороты.Регистратор.Ответственный КАК Ответственный,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(КоличествоРазбитий.КоличествоРазбивок, 0) = 0
				ТОГДА ПродажиОбороты.КоличествоОборот
			ИНАЧЕ ПродажиОбороты.КоличествоОборот / КоличествоРазбитий.КоличествоРазбивок
		КОНЕЦ) КАК Количество,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(КоличествоРазбитий.КоличествоРазбивок, 0) = 0
				ТОГДА ПродажиОбороты.СтоимостьОборот
			ИНАЧЕ ПродажиОбороты.СтоимостьОборот / КоличествоРазбитий.КоличествоРазбивок
		КОНЕЦ) КАК Продажии,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ПродажиСебестоимостьОбороты.Стоимость_УПРОборот, 0) &gt; 0
				ТОГДА ЕСТЬNULL(ПродажиСебестоимостьОбороты.Стоимость_УПРОборот, 0)
			ИНАЧЕ ЕСТЬNULL(ПродажиСебестоимостьОбороты.СтоимостьОборот, 0)
		КОНЕЦ) КАК Себестоимость,
	ВЫБОР
		КОГДА ПродажиОбороты.Регистратор.Склад ЕСТЬ NULL
			ТОГДА ПродажиОбороты.Регистратор.СкладОрдер
		ИНАЧЕ ПродажиОбороты.Регистратор.Склад
	КОНЕЦ КАК Магазин,
	ПродажиОбороты.Регистратор,
	ПродажиСебестоимостьОбороты.ДокументОприходования,
	ПродажиСебестоимостьОбороты.КоличествоОборот КАК КоличествоПродажиСебестоимость,
	КоличествоРазбитий.КоличествоРазбивок,
	ЕСТЬNULL(КоэффициентыПонижения.Коэффициент, 1) КАК КоэффициентПонижения
ПОМЕСТИТЬ ВТТаблица
ИЗ
	РегистрНакопления.Продажи.Обороты(&amp;ДатаН, КОНЕЦПЕРИОДА(&amp;ДатаК, ДЕНЬ), Регистратор, ) КАК ПродажиОбороты
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПродажиСебестоимость.Обороты(&amp;ДатаН, КОНЕЦПЕРИОДА(&amp;ДатаК, ДЕНЬ), Регистратор, ) КАК ПродажиСебестоимостьОбороты
			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КоэффициентыПонижения КАК КоэффициентыПонижения
			ПО (ПродажиСебестоимостьОбороты.ДокументОприходования.Дата МЕЖДУ КоэффициентыПонижения.ДатаНачала И КоэффициентыПонижения.ДатаОкончания)
		ПО ПродажиОбороты.Регистратор = ПродажиСебестоимостьОбороты.Регистратор
			И ПродажиОбороты.Номенклатура = ПродажиСебестоимостьОбороты.Номенклатура
			И ПродажиОбороты.ХарактеристикаНоменклатуры = ПродажиСебестоимостьОбороты.ХарактеристикаНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ПродажиСебестоимость.Регистратор КАК Регистратор,
			ПродажиСебестоимость.Номенклатура КАК Номенклатура,
			ПродажиСебестоимость.ХарактеристикаНоменклатуры КАК ХарактеристикаНоменклатуры,
			КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ПродажиСебестоимость.ДокументОприходования) КАК КоличествоРазбивок
		ИЗ
			РегистрНакопления.ПродажиСебестоимость КАК ПродажиСебестоимость
		ГДЕ
			(ПродажиСебестоимость.Регистратор ССЫЛКА Документ.ОтчетОРозничныхПродажах
					ИЛИ ПродажиСебестоимость.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
					ИЛИ ПродажиСебестоимость.Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя)
			И ПродажиСебестоимость.Период МЕЖДУ &amp;ДатаН И &amp;ДатаК
		
		СГРУППИРОВАТЬ ПО
			ПродажиСебестоимость.Регистратор,
			ПродажиСебестоимость.Номенклатура,
			ПродажиСебестоимость.ХарактеристикаНоменклатуры) КАК КоличествоРазбитий
		ПО ПродажиОбороты.Регистратор = КоличествоРазбитий.Регистратор
			И ПродажиОбороты.Номенклатура = КоличествоРазбитий.Номенклатура
			И ПродажиОбороты.ХарактеристикаНоменклатуры = КоличествоРазбитий.ХарактеристикаНоменклатуры
ГДЕ
	(ПродажиОбороты.Регистратор ССЫЛКА Документ.ОтчетОРозничныхПродажах
			ИЛИ ПродажиОбороты.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
			ИЛИ ПродажиОбороты.Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя)

СГРУППИРОВАТЬ ПО
	ПродажиОбороты.Регистратор.Ответственный,
	ПродажиОбороты.Организация,
	ПродажиОбороты.Номенклатура,
	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа,
	ВЫБОР
		КОГДА ПродажиОбороты.Регистратор.Склад ЕСТЬ NULL
			ТОГДА ПродажиОбороты.Регистратор.СкладОрдер
		ИНАЧЕ ПродажиОбороты.Регистратор.Склад
	КОНЕЦ,
	ПродажиОбороты.Регистратор,
	ПродажиСебестоимостьОбороты.ДокументОприходования,
	ПродажиСебестоимостьОбороты.КоличествоОборот,
	КоличествоРазбитий.КоличествоРазбивок,
	ЕСТЬNULL(КоэффициентыПонижения.Коэффициент, 1)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТТаблица.НоменклатурнаяГруппа,
	ВТТаблица.Номенклатура,
	ВТТаблица.Организация,
	ВТТаблица.Ответственный,
	ВТТаблица.Количество,
	ВТТаблица.Продажии,
	ВТТаблица.Себестоимость,
	ВТТаблица.Магазин,
	МО.МинОстаток,
	Кат.Категория,
	ВТТаблица.Регистратор,
	ВТТаблица.ДокументОприходования,
	ВТТаблица.КоличествоПродажиСебестоимость,
	ВТТаблица.КоэффициентПонижения
ПОМЕСТИТЬ Итог
ИЗ
	ВТТаблица КАК ВТТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ МО КАК МО
		ПО ВТТаблица.Номенклатура = МО.Номенклатура
			И ВТТаблица.Магазин = МО.Склад
		ЛЕВОЕ СОЕДИНЕНИЕ Кат КАК Кат
		ПО ВТТаблица.Магазин = Кат.Объект
{ХАРАКТЕРИСТИКИ
	ТИП(Справочник.Номенклатура)
	ВИДЫХАРАКТЕРИСТИК ПланВидовХарактеристик.СвойстваОбъектов
	ПОЛЕКЛЮЧА Ссылка
	ПОЛЕИМЕНИ Наименование
	ПОЛЕТИПАЗНАЧЕНИЯ ТипЗначения
	ЗНАЧЕНИЯХАРАКТЕРИСТИК РегистрСведений.ЗначенияСвойствОбъектов
	ПОЛЕОБЪЕКТА Объект
	ПОЛЕВИДА Свойство
	ПОЛЕЗНАЧЕНИЯ Значение }
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Итог.НоменклатурнаяГруппа,
	Итог.Номенклатура,
	Итог.Организация,
	Итог.Ответственный,
	Итог.Количество,
	Итог.Продажии,
	Итог.Себестоимость,
	Итог.Магазин,
	Итог.МинОстаток,
	Итог.Категория,
	Итог.Регистратор,
	ВЫБОР
		КОГДА ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.БезНДС)
				ИЛИ ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.ПустаяСсылка)
				ИЛИ ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС0)
				ИЛИ ВложенныйЗапрос.СтавкаНДС ЕСТЬ NULL
			ТОГДА 0
		КОГДА ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС10)
				ИЛИ ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС10_110)
			ТОГДА 10
		КОГДА ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС18)
				ИЛИ ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС18_118)
			ТОГДА 18
		КОГДА ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС20)
				ИЛИ ВложенныйЗапрос.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНдс.НДС20_120)
			ТОГДА 20
	КОНЕЦ КАК ЗначениеНДС,
	Итог.ДокументОприходования,
	Итог.Организация.ИНН,
	Итог.КоличествоПродажиСебестоимость,
	Итог.ДокументОприходования.ДоговорКонтрагента.Наименование КАК ДоговорКонтрагентаНаименование,
	Итог.КоэффициентПонижения,
	ВЫБОР
		КОГДА Итог.Организация.ИНН = "781122201700"
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК флЭтоПДВ
ПОМЕСТИТЬ ПолныйИТОГ
ИЗ
	Итог КАК Итог
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ПоступлениеТоваровУслугТовары.Ссылка КАК Ссылка,
			ПоступлениеТоваровУслугТовары.Номенклатура КАК Номенклатура,
			МАКСИМУМ(ПоступлениеТоваровУслугТовары.СтавкаНДС) КАК СтавкаНДС
		ИЗ
			Документ.ПоступлениеТоваровУслуг.Товары КАК ПоступлениеТоваровУслугТовары,
			Итог КАК Итог
		ГДЕ
			ПоступлениеТоваровУслугТовары.Ссылка В (Итог.ДокументОприходования)
		
		СГРУППИРОВАТЬ ПО
			ПоступлениеТоваровУслугТовары.Ссылка,
			ПоступлениеТоваровУслугТовары.Номенклатура) КАК ВложенныйЗапрос
		ПО Итог.Номенклатура = ВложенныйЗапрос.Номенклатура
			И Итог.ДокументОприходования = ВложенныйЗапрос.Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПолныйИТОГ.НоменклатурнаяГруппа,
	ПолныйИТОГ.Номенклатура,
	ПолныйИТОГ.Организация,
	ПолныйИТОГ.Ответственный,
	ВЫРАЗИТЬ(ПолныйИТОГ.КоличествоПродажиСебестоимость КАК ЧИСЛО(10, 2)) КАК Количество,
	ВЫРАЗИТЬ(ПолныйИТОГ.Продажии КАК ЧИСЛО(10, 2)) КАК Продажии,
	ПолныйИТОГ.Себестоимость,
	ПолныйИТОГ.Магазин,
	ПолныйИТОГ.МинОстаток,
	ПолныйИТОГ.Категория,
	ПолныйИТОГ.Регистратор,
	ПолныйИТОГ.ДокументОприходования,
	ПолныйИТОГ.ЗначениеНДС,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ПолныйИТОГ.флЭтоПДВ
				ТОГДА ВЫРАЗИТЬ(ПолныйИТОГ.Продажии / (1 + 20 / 100) КАК ЧИСЛО(10, 2))
			ИНАЧЕ ПолныйИТОГ.Продажии
		КОНЕЦ КАК ЧИСЛО(10, 2)) КАК ПродажиБезНДС,
	ВЫРАЗИТЬ(ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100) КАК ЧИСЛО(10, 2)) КАК СебестоимостьБезНДС,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ПолныйИТОГ.флЭтоПДВ
				ТОГДА ВЫРАЗИТЬ(ПолныйИТОГ.Продажии - ПолныйИТОГ.Продажии / (1 + 20 / 100) КАК ЧИСЛО(10, 2))
			ИНАЧЕ 0
		КОНЕЦ КАК ЧИСЛО(10, 2)) КАК НДСПродаж,
	ВЫРАЗИТЬ(ПолныйИТОГ.Себестоимость - ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100) КАК ЧИСЛО(10, 2)) КАК НДССебестоимости,
	ПолныйИТОГ.ОрганизацияИНН,
	ПолныйИТОГ.Регистратор.Контрагент,
	ПолныйИТОГ.КоличествоПродажиСебестоимость,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ПолныйИТОГ.флЭтоПДВ
				ТОГДА ВЫБОР
						КОГДА ПолныйИТОГ.ДоговорКонтрагентаНаименование = &amp;НаименованиеДоговора
								И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 1, 1)
								И ПолныйИТОГ.ДокументОприходования.Дата &lt; ДАТАВРЕМЯ(2021, 7, 1)
							ТОГДА ПолныйИТОГ.Себестоимость / 1.5
						ИНАЧЕ ВЫБОР
								КОГДА (ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;Ильина
										ИЛИ ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;Ульянова)
										И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 7, 1)
									ТОГДА ПолныйИТОГ.Себестоимость
								ИНАЧЕ ВЫБОР
										КОГДА ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;Трубач
												И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2022, 8, 9)
											ТОГДА ПолныйИТОГ.Себестоимость
										ИНАЧЕ ПолныйИТОГ.Себестоимость
									КОНЕЦ
							КОНЕЦ
					КОНЕЦ
			ИНАЧЕ ВЫБОР
					КОГДА ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;КонтрагентПДВ
							И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 1, 1)
							И ПолныйИТОГ.Организация &lt;&gt; &amp;ОрганизацияТабакон
							И ПолныйИТОГ.Регистратор.Дата &lt; ДАТАВРЕМЯ(2022, 1, 1)
						ТОГДА ПолныйИТОГ.Себестоимость / ПолныйИТОГ.КоэффициентПонижения
					ИНАЧЕ ВЫБОР
							КОГДА ПолныйИТОГ.ДоговорКонтрагентаНаименование = &amp;НаименованиеДоговора
									И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 1, 1)
								ТОГДА ПолныйИТОГ.Себестоимость / 1.02
							ИНАЧЕ ПолныйИТОГ.Себестоимость
						КОНЕЦ
				КОНЕЦ
		КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СебестоимостьУПР,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ПолныйИТОГ.флЭтоПДВ
				ТОГДА ВЫБОР
						КОГДА ПолныйИТОГ.ДоговорКонтрагентаНаименование = &amp;НаименованиеДоговора
								И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 1, 1)
								И ПолныйИТОГ.ДокументОприходования.Дата &lt; ДАТАВРЕМЯ(2021, 7, 1)
							ТОГДА ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100) / 1.5
						ИНАЧЕ ВЫБОР
								КОГДА (ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;Ильина
										ИЛИ ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;Ульянова)
										И ПолныйИТОГ.ДокументОприходования.Дата &gt; ДАТАВРЕМЯ(2021, 7, 1)
									ТОГДА ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100)
								ИНАЧЕ ВЫБОР
										КОГДА ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;Трубач
												И ПолныйИТОГ.ДокументОприходования.Дата &gt; ДАТАВРЕМЯ(2022, 8, 9)
											ТОГДА ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100)
										ИНАЧЕ ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100)
									КОНЕЦ
							КОНЕЦ
					КОНЕЦ
			ИНАЧЕ ВЫБОР
					КОГДА ПолныйИТОГ.ДокументОприходования.Контрагент = &amp;КонтрагентПДВ
							И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 1, 1)
							И ПолныйИТОГ.Организация &lt;&gt; &amp;ОрганизацияТабакон
							И ПолныйИТОГ.Регистратор.Дата &lt; ДАТАВРЕМЯ(2022, 1, 1)
						ТОГДА ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100) / ПолныйИТОГ.КоэффициентПонижения
					ИНАЧЕ ВЫБОР
							КОГДА ПолныйИТОГ.ДоговорКонтрагентаНаименование = &amp;НаименованиеДоговора
									И ПолныйИТОГ.ДокументОприходования.Дата &gt;= ДАТАВРЕМЯ(2021, 1, 1)
								ТОГДА ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100) / 1.02
							ИНАЧЕ ПолныйИТОГ.Себестоимость / (1 + ПолныйИТОГ.ЗначениеНДС / 100)
						КОНЕЦ
				КОНЕЦ
		КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СебестоимостьБезНДС_УПР,
	ПолныйИТОГ.КоэффициентПонижения,
	ПолныйИТОГ.флЭтоПДВ
ПОМЕСТИТЬ ВТ_Т
ИЗ
	ПолныйИТОГ КАК ПолныйИТОГ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Т.Регистратор,
	Т.Номенклатура,
	Т.Магазин,
	СУММА(Т.КоличествоПродажиСебестоимость) КАК КоличествоПродажиСебестоимость,
	СУММА(Т.СебестоимостьУПР) КАК СебестоимостьУПР,
	СУММА(Т.Продажии) КАК Продажии,
	СУММА(Т.ПродажиБезНДС) КАК ПродажиБезНДС,
	СУММА(Т.СебестоимостьБезНДС_УПР) КАК СебестоимостьБезНДС_УПР,
	СУММА(ВЫБОР
			КОГДА Т.флЭтоПДВ
				ТОГДА Т.ПродажиБезНДС - Т.СебестоимостьБезНДС_УПР
			ИНАЧЕ Т.Продажии - Т.СебестоимостьУПР
		КОНЕЦ) КАК ПрибыльУПР,
	СУММА(ВЫБОР
			КОГДА Т.флЭтоПДВ
				ТОГДА Т.СебестоимостьБезНДС_УПР
			ИНАЧЕ Т.СебестоимостьУПР
		КОНЕЦ) КАК СебестоимостьИтого
ПОМЕСТИТЬ ВТ_Т2
ИЗ
	ВТ_Т КАК Т
ГДЕ
	Т.Магазин &lt;&gt; ЗНАЧЕНИЕ(Справочник.Склады.ПустаяССылка)

СГРУППИРОВАТЬ ПО
	Т.Регистратор,
	Т.Номенклатура,
	Т.Магазин
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Т.Регистратор.Дата КАК Дата,
	Т.Регистратор,
	Т.Номенклатура,
	Т.СебестоимостьУПР,
	Т.СебестоимостьБезНДС_УПР,
	Т.Магазин,           
	Т.ПрибыльУПР,
	Т.СебестоимостьИтого,
	ПРЕДСТАВЛЕНИЕ(Т.Регистратор) КАК РегистраторПредставление,
	Т.Продажии,
	Т.ПродажиБезНДС
ИЗ
	ВТ_Т2 КАК Т</query>
	</dataSet>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>ДатаКон</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата кон</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ДатаНач</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата нач</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>Ильина</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Ильина</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Контрагенты</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>КонтрагентПДВ</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Контрагент ПДВ</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Контрагенты</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>НаименованиеДоговора</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Наименование договора</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:string</v8:Type>
			<v8:StringQualifiers>
				<v8:Length>50</v8:Length>
				<v8:AllowedLength>Variable</v8:AllowedLength>
			</v8:StringQualifiers>
		</valueType>
		<value xsi:type="xs:string"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ОрганизацияТабакон</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Организация табакон</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Организации</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>Трубач</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Трубач</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Контрагенты</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>Ульянова</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Ульянова</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Контрагенты</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ДатаК</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата К</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ДатаН</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата Н</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Дата</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Магазин</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Номенклатура</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПрибыльУПР</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПродажиБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Продажии</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Регистратор</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СебестоимостьБезНДС_УПР</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СебестоимостьИтого</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СебестоимостьУПР</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>